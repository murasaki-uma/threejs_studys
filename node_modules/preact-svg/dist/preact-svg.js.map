{"version":3,"file":"preact-svg.js","sources":["../src/index.js"],"sourcesContent":["import { h, Component } from 'preact';\n\nconst DOM = typeof document!=='undefined' && !!document.createElement;\n\nconst SVG_ATTRS = ['viewBox'];\n\nconst NS = {\n\txlink: 'http://www.w3.org/1999/xlink'\n}\n\nconst NS_ATTR = /^([a-zA-Z]+)(?:\\:|([A-Z]))/;\n\nconst PROP_TO_ATTR_MAP = {\n\t'className': 'class'\n};\n\nconst EMPTY = {};\n\n\n/** During <SVG> DOM building, this flag is set to `true`.\n *\t@private\n */\nlet updateMode = false;\n\n\nif (DOM) {\n\tlet div = document.createElement('div');\n\n\t/** Hook into document.createElement() to slap a namespace on manually namespaced nodes (yup)\n\t *\t@private\n\t */\n\tlet oldCreate = document.createElement;\n\tdocument.createElement = name => {\n\t\tif (updateMode || name==='svg') {\n\t\t\tlet el = document.createElementNS('http://www.w3.org/2000/svg', name);\n\t\t\t// shim setAttribute to automatically apply namespaces\n\t\t\tel.setAttribute = createAttributeShim('setAttribute');\n\t\t\tel.getAttribute = createAttributeShim('getAttribute');\n\t\t\tel.removeAttribute = createAttributeShim('removeAttribute');\n\t\t\tfor (let key in el) {\n\t\t\t\tif (~SVG_ATTRS.indexOf(key) || !(key in div) || PROP_TO_ATTR_MAP.hasOwnProperty(key)) {\n\t\t\t\t\toverwriteProperty(el, key);\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn el;\n\t\t}\n\t\treturn oldCreate.call(document, name);\n\t};\n}\n\n\nconst PROPERTY_ERRORS = {};\nlet hasPropertyErrors = false;\n\nfunction overwriteProperty(el, key) {\n\tlet err = PROPERTY_ERRORS[key];\n\tif (err===false) {\n\t\tObject.defineProperty(el, key, contentPropertyDef(key));\n\t}\n\telse {\n\t\tattemptOverwriteProperty(el, key);\n\t}\n}\n\nfunction attemptOverwriteProperty(el, key) {\n\ttry {\n\t\tObject.defineProperty(el, key, contentPropertyDef(key));\n\t\tPROPERTY_ERRORS[key] = false;\n\t}\n\tcatch (e) {\n\t\tif (!PROPERTY_ERRORS[key]) {\n\t\t\tlet err = el.nodeName+': '+e;\n\t\t\tPROPERTY_ERRORS[key] = err;\n\t\t\tif (!hasPropertyErrors && 'undefined'!==typeof console && console.warn) {\n\t\t\t\thasPropertyErrors = true;\n\t\t\t\tconsole.warn('Error overwriting some SVG properties.', { errors: PROPERTY_ERRORS });\n\t\t\t}\n\t\t}\n\t}\n}\n\n\n/** Cache return values from a function using the first argument as a key.\n *\t@private\n */\nlet memoize = (fn, mem={}) => k => mem.hasOwnProperty(k) ? mem[k] : (mem[k] = fn(k));\n\n\n/** Create a getter/setter pair for a Content Property that proxies to the corresponding attribute.\n *\t@private\n */\nlet contentPropertyDef = memoize( (prop, attr=(PROP_TO_ATTR_MAP[prop] || prop)) => ({\n\tset(v) {\n\t\tif (v===null || v===undefined) this.removeAttribute(attr);\n\t\telse this.setAttribute(attr, v);\n\t},\n\tget() { return this.getAttribute(attr); }\n}) );\n\n\nlet createAttributeShim = memoize( method => function(name, value) {\n\tlet proto = this.constructor.prototype,\n\t\tp = name.match(NS_ATTR);\n\tif (p && NS.hasOwnProperty(p[1])) {\n\t\tname = name.replace(NS_ATTR, '$2').toLowerCase();\n\t\tlet ns = NS[p[1]];\n\t\treturn proto[method+'NS'].call(this, ns, name, value);\n\t}\n\telse {\n\t\treturn proto[method].call(this, name, value);\n\t}\n});\n\n\n\n/** Wrapper around <svg> that provides Preact support.\n *\t@public\n */\nexport default class SVG extends Component {\n\tcomponentWillUpdate() {\n\t\tupdateMode = true;\n\t}\n\n\t// after any update, manually apply exempted readOnly SVG properties as attributes:\n\tcomponentDidUpdate() {\n\t\tupdateMode = false;\n\t}\n\n\trender({ children, ...props }) {\n\t\t// componentWillUpdate() is not called on first render, so we have to shim that here.\n\t\t// thankfully, first render() does synchronous DOM generation so it works fine.\n\t\tif (!this.hasRendered) {\n\t\t\tthis.hasRendered = updateMode = true;\n\t\t\t// componentDidUpdate() is not called after initial render,\n\t\t\t// so we use a setState() callback to call it manually:\n\t\t\tthis.setState(EMPTY, setStateUpdateProxy(this));\n\t\t}\n\n\t\treturn <svg version=\"1.1\" xmlns=\"http://www.w3.org/2000/svg\" {...props}>{ children }</svg>;\n\t}\n}\n\n\nfunction setStateUpdateProxy(component) {\n\treturn () => {\n\t\tcomponent.componentDidUpdate();\n\t\tcomponent = null;\n\t};\n}\n"],"names":["h","Component"],"mappings":"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"}